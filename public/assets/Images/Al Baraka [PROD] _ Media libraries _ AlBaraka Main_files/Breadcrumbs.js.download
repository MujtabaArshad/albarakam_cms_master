cmsdefine(["CMS/EventHub","CMS/UrlHelper","CMS/NavigationBlocker","Underscore","jQuery"],function(n,t,i,r,u){var e=30,o=new i,s=function(i,r,u,f){var e=this;return function(s){if(o.canNavigate()){if(e.breadcrumbsOverwritten=!1,i&&e.isSingleObject)return n.publish("SingleObjectNavigationAppBreadcrumbClick",{appId:e.appId,tabName:e.tabName}),!0;var h,c=!0;f&&(f="(function () {"+f+"}());",c=u.eval(f));c!==!1&&(i&&r.indexOf("?")!=-1&&(h=t.getQueryString(r),h=t.removeParameter(h,"parentobjectid"),r=r.slice(0,r.indexOf("?"))+h),u.location.href=r)}else return s.preventDefault(),!1}},f=function(t){var i=this;this.moreBreadcrumbsText=t.moreBreadcrumbsText;this.splitViewText=t.splitViewModeText;this.$breadcrumbsWrapper=u("#js-nav-breadcrumb");this.$navBar=u(".navbar.cms-navbar");this.$navBarRightBtns=u(".navbar.cms-navbar .nav.navbar-right");this.navBarWidth=this.$navBar.width();this.$breadcrumbs=[];this.breadcrumbsData=[];this.rootBreadcrumbData={};this.isSingleObject=!1;this.appId=null;this.tabName=null;this.breadcrumbsOverwritten=!1;n.subscribe("Breadcrumbs_Back",function(n){i.goBack(n)});n.subscribe("KeyPressed",function(n){n.ctrlKey&&n.altKey&&n.key==37&&(i.goBack({}),n.wasHandled=!0)});n.subscribe("ApplicationChanged",function(n){if(!i.breadcrumbsOverwritten){var t=r.flatten(n,!0);i.continueProcessing(t[0])&&(i.clearBreadcrumbs(),i.processData(t),i.renderBreadcrumbs())}});window.addEventListener("resize",r.debounce(function(){i.navBarWidth=i.$navBar.width();i.clearBreadcrumbs();i.renderBreadcrumbs()},1e3/30));n.subscribe("NavigatingToSingleObject",function(n){i.isSingleObject=!0;i.appId=n.appId;n.hashParameters&&(i.tabName=n.hashParameters.parenttabname)});n.subscribe("NavigationToApplication",function(){i.isSingleObject=!1;i.appId=null});n.subscribe("OverwriteBreadcrumbs",function(n){i.breadcrumbsOverwritten=!0;i.clearBreadcrumbs();n&&n.data&&n.data.length&&n.data.forEach(function(n){var t=n.suffix?" ("+n.suffix+")":"";n.frame=window;i.renderBreadcrumb(n,u.prototype.appendTo,i.$breadcrumbsWrapper,!n.redirectUrl,n.isRoot,t,n.suffix?"breadcrumb-last":"")});u(window).one("hashchange",function(){i.breadcrumbsOverwritten=!1})})};return f.prototype.goBack=function(n){var o=this.$breadcrumbs,s=this.$breadcrumbs.length,f,r,t,e,i;if(!n.received){for(n.received=!0,r=s-1;r>=0;r--)if(f=o[r],t=f.children(),e=t.get(0)&&u._data(t.get(0),"events"),e&&e.click)if(n.sender==null||f.breadcrumbData.frame==n.sender){i=t;break}else i==null&&(i=t);if(i!=null)return i.click(),n.back=!0,!0}return!1},f.prototype.clearBreadcrumbs=function(){for(var t=this.$breadcrumbs,i=this.$breadcrumbs.length,n=0;n<i;n++)t[n].remove();this.$breadcrumbs=[]},f.prototype.processData=function(n){for(var s=[],h=-1,c,l,p=!1,w=!1,a,b="",t,r,i,y,f,e,o,k,u=0,v=n.length;u<v;u++){if(t=n[u],r=t.frame,!this.continueProcessing(t[0]))break;if((!a&&t.applicationName&&(a=t.applicationName),t.hasOwnProperty("breadcrumbsSuffix")&&(b=t.breadcrumbsSuffix?" ("+t.breadcrumbsSuffix+")":""),t.isSplitView&&(t.breadcrumbs=t.breadcrumbs||{},t.breadcrumbs.data=[{text:this.splitViewText}],u=v),t.breadcrumbs)&&(f=t.breadcrumbs.reframe,i=t.breadcrumbs.data,i.length>0&&!t.isDialog))for(h>=0&&f&&(e=s[h],e.redirectUrl=i[0].redirectUrl,e.onClientClick=i[0].onClientClick,e.frame=i[0].target&&i[0].target==="_parent"?r.parent:r),w||(p=f,l=r,c=i[0],w=!0,i[0].target&&i[0].target==="_parent"&&(l=r.parent)),o=f?1:0,k=i.length;o<k;o++)y=i[o],y.frame=r,s.push(y),h++}this.rootBreadcrumbData={};this.rootBreadcrumbData.text=a;this.rootBreadcrumbData.frame=l;p&&(this.rootBreadcrumbData.redirectUrl=c.redirectUrl,this.rootBreadcrumbData.onClientClick=c.onClientClick);this.breadcrumbsSuffix=b;this.breadcrumbsData=s},f.prototype.continueProcessing=function(n){return n&&"breadcrumbsRefresh"in n&&n.breadcrumbsRefresh===!1?!1:!0},f.prototype.renderBreadcrumbs=function(){var n=this.breadcrumbsData,c=n.length,o,s=[],h,r=this.navBarWidth-(this.$breadcrumbsWrapper.position().left+this.$breadcrumbsWrapper.width())-this.$navBarRightBtns.width()-e,t,f,i;for(this.rootBreadcrumbData.text&&(h=this.renderBreadcrumb(this.rootBreadcrumbData,u.prototype.appendTo,this.$breadcrumbsWrapper,c===0,!0),r-=h),o=this.renderBreadcrumbsInternal(n,u.prototype.appendTo,this.$breadcrumbsWrapper,!1,s),n.length>1&&o>r&&(this.clearBreadcrumbs(),this.renderHiddenBreadcrumbs(s,r)),f=u(".cms-nav-breadcrumb select"),t=f.val()!="0"?f.find("option:selected").html():"Administration",this.rootBreadcrumbData.text&&(t+=" / "+this.rootBreadcrumbData.text),i=0;i<n.length;i++)t+=" / "+n[i].text;window.document.title=u("<div/>").html(t).text()},f.prototype.renderHiddenBreadcrumbs=function(n,t){var l=this.breadcrumbsData,a=l.length,o=n.length,i,s,r,f,h,c,e;for(this.rootBreadcrumbData.text&&this.renderBreadcrumb(this.rootBreadcrumbData,u.prototype.appendTo,this.$breadcrumbsWrapper,a===0,!0,"","ico-after"),r=u('<li class="dropdown no-ico"><a data-toggle="dropdown" class="dropdown-toggle" href="javascript:void(0)"><i aria-hidden="true" class="icon-ellipsis cms-icon-80"><\/i><span class="sr-only">'+this.moreBreadcrumbsText+"<\/span><\/a><\/li>"),r.appendTo(this.$breadcrumbsWrapper),e=r.width()+n[o-1],i=o-2,s=1;i>=s;i--)if(e+=n[i],e>t)break;i++;h=this.breadcrumbsData.slice(i);c=this.breadcrumbsData.slice(0,i);f=u('<ul class="dropdown-menu"><\/ul>');this.renderBreadcrumbsInternal(c,u.prototype.appendTo,f,!0);f.appendTo(r);this.$breadcrumbs.push(r);this.renderBreadcrumbsInternal(h,u.prototype.appendTo,this.$breadcrumbsWrapper,!1)},f.prototype.renderBreadcrumbsInternal=function(n,t,i,r,u){for(var s,a=0,v,h,e,c,l,f=0,o=n.length;f<o;f++)v=n[f],e=f===o-1,c="",l="",r?h=!1:(h=e,c=e?"breadcrumb-last":"",l=e?this.breadcrumbsSuffix:""),s=this.renderBreadcrumb(v,t,i,h,!1,l,c),a+=s,u&&u.push(s);return a},f.prototype.renderBreadcrumb=function(n,t,i,r,f,e,o){r=typeof r!="undefined"?r:!1;var c,h=u("<li><\/li>"),l=n.text;return f&&h.addClass("no-ico"),r?h.html(l):(c=u('<a href="javascript:void(0)">'+l+"<\/a>"),c.click(s.call(this,f,n.redirectUrl,n.frame,n.onClientClick)),h.append(c)),e&&h.append("<span>"+e+"<\/span>"),h.addClass(o),h.breadcrumbData=n,this.$breadcrumbs.push(h),t.call(h,i),h.width()},f})