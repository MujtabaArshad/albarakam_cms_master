cmsdefine(["CMS/EventHub","CMS/Application","jQuery"],function(n,t,i){var r=function(t){var r=this;this._$pinParentElement=i("#"+t.pinId+"-list");this._$pinElement=i("#"+t.pinId+"-i");n.subscribe("ApplicationChanged",function(n){r._$pinParentElement.hide();var i=_.flatten(n),f=i.shift(),u=i.filter(function(n){return n.breadcrumbs||n.breadcrumbsPin}),t=_.isEmpty(u)?f:_.last(u);t&&t.breadcrumbsPin&&(!t.breadcrumbs||t.breadcrumbsPin.elementGuid)&&r.show(t.breadcrumbsPin)});n.subscribe("OverwriteBreadcrumbs",function(n){n.pin&&r.show(n.pin)})};return r.prototype.show=function(n){var r=this,f=function(){r._$pinElement.removeClass("icon-pin-o");r._$pinElement.removeClass("icon-disabled");r._$pinElement.addClass("icon-pin");r._$pinElement.attr("title",r._$pinElement.attr("data-action-text-unpin"))},e=function(){r._$pinElement.removeClass("icon-pin");r._$pinElement.addClass("icon-pin-o");r._$pinElement.addClass("icon-disabled");r._$pinElement.attr("title",r._$pinElement.attr("data-action-text-pin"))},u=function(n){n?f():e()};u(n.isPinned);r._$pinParentElement.show();r._$pinElement.off();r._$pinElement.on("click",function(){var r=i(this);r.attr("data-pending")||(r.attr("data-pending",!0),u(!n.isPinned),i.post(t.getData("applicationUrl")+"cmsapi/PinHandler/"+(n.isPinned?"Unpin":"Pin"),n).done(function(){r.removeAttr("data-pending");n.isPinned=!n.isPinned}))})},r})