cmsdefine(["CMS/EventHub","CMS/NavigationBlocker","Underscore","jQuery","jQueryFancySelector"],function(n,t,i,r){var u=function(u){var o=r("#"+u.selectorId),s=r(window),h=r('iframe[name="cmsdesktop"]'),c=r("#"+u.dashboardLinkId),e,f=this;o.fancySelect();r(".site-selector").show();e=r(".fancy-select .dropdown");this.$opener=e;this.$options=r(".fancy-select .dropdown-menu");this.$mainIframe=h;this.navigationBlocker=new t;this.$options.find("li").click(function(n){return i.contains(this.classList,"selected")?(f.fancySelectorHide(),n.preventDefault(),!1):f.navigationBlocker.canNavigate()?void 0:(f.fancySelectorHide(),n.preventDefault(),!1)});c.click(function(t){t.which===2||t.ctrlKey||n.publish("DashboardClicked",t)});e.click(function(){f.$options.hasClass("open")&&f.fancySelectorUpdateMaxHeight()});s.resize(i.debounce(function(){f.$options&&f.fancySelectorUpdateMaxHeight()},250));n.subscribe("GlobalClick",function(n){n.target!==e[0]&&f.fancySelectorHide()})};return u.prototype.fancySelectorUpdateMaxHeight=function(){var n=this.$mainIframe.height()*.8;this.$options.css({"max-height":n+"px"})},u.prototype.fancySelectorHide=function(){this.$options.removeClass("open");this.$opener.removeClass("open")},u})