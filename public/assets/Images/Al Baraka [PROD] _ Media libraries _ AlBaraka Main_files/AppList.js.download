cmsdefine(["CMS/Filter","CMS/EventHub","CMS/NavigationBlocker","CMS/Application","jQuery","Underscore","CMS/UrlHelper","jQueryJScrollPane","CMS/Loader"],function(n,t,i,r,u,f,e){var a,o={duration:200,opacity:"0.4",scrollStep:20,applicationListBaseUrl:"",defaultAppUrl:"",defaultAppName:"",launchAppWithQuery:"",targetFrame:"cmsdesktop",appListWrapperElemSelector:"#cms-applist",appListPanelSelector:"#cms-applist-panel",appListOverLayerSelector:"#cms-overlayer",appListToggleSelector:"#cms-applist-toggle",appListToggleCloseSelector:"#cms-applist-toggle-close",appListHeaderSelector:"#cms-applist-header",appListContentSelector:"#cms-applist",appListLiveSiteButtonSelector:".btn-livesite",appListScrollableElemSelector:".js-scrollable",appListScrollShadowElemSelector:'<div class="scroll-shadow"><\/div>',appListSearchInputSelector:".js-filter-search"},ut=null,ft="pinned",dt="dashboard-edit-mode",gt="icon-pin",ni="icon-pin-o",ti=new i,y=!1,ii=64,p=[],h=ut,et=[],ot=[],st=[],ht=!1,ct=!0,ri=!1,ui=!1,w=!1,lt=!1,at=window.frames[o.targetFrame],fi,vt,yt,b,k,ei,oi,di,nt,si,d,g,s,c,hi=function(){var t=f.toArray(arguments),n="";return f.each(t,function(t){(t===undefined||t===null)&&(t="");n+=t}),n},pt=function(){var i,n;ht&&(ct=!1);b.show();t.publish({name:"ApplicationListShown",onlySubscribed:!0});h&&(i=b.find("*[data-appguid="+h+"]"),ci(i));lt?gi():(k.show(),k.animate({opacity:o.opacity},{duration:o.duration,queue:!1}));n=b.width();vt.animate({left:n,right:-n},{duration:o.duration,queue:!1,complete:function(){ui||(tr(),ui=!0);or()}});y=!0},l=function(){t.publish({name:"ApplicationListHidden",onlySubscribed:!0});k.animate({opacity:"0.0"},{duration:o.duration,queue:!1});vt.animate({left:"0px",right:"0px"},o.duration,function(){k.hide();sr()});y=!1},gi=function(){ci(nt.find(".js-filter-item").first())},ci=function(n){var t=u(n.closest(".panel.panel-default")[0]),r=t.find(".accordion-toggle"),i=t.find(".panel-collapse");i.addClass("no-transition");r.click();setTimeout(function(){i.removeClass("no-transition")},0)},li=function(n,t,i){t?d.hide():d.show();i?g.hide():g.show()},nr=function(n,t){t?li(n,s.getPercentScrolledY()===0,s.getPercentScrolledY()===1):(d.hide(),g.hide())},tr=function(){var n=c.offset();c.css({position:"absolute",top:n.top+"px",left:0,right:0,bottom:ii+"px",outline:"none"});c.jScrollPane({verticalGutter:-8});s=c.data("jsp");c.bind("jsp-arrow-change",li);c.bind("jsp-initialised",nr);d.prependTo(c);g.prependTo(c)},ai=function(){y?l():pt()},ir=function(n){n.received||(n.received=!0,h&&tt({appId:appId}))},tt=function(n){h=n.appId;var f=bt(n.appId),u=!!n.hashParameters&&!!n.hashParameters.elementguid,r="",i=n.hashParameters||{};i.displaytitle="false";i.elementguid=i.elementguid||h;r=e.buildQueryString(i);u&&(w=!0);o.launchAppWithQuery.length>0&&(r+="&"+o.launchAppWithQuery);v(at,"href",o.applicationListBaseUrl+r,function(){window.Loader&&window.Loader.show();ht=!0;vi(h,f);i.persistent?w=!1:window.location.hash=h;u?t.publish("NavigatingToSingleObject",n):t.publish("NavigationToApplication",h)})},v=function(n,t,i,r){ti.canNavigate()?(n.location[t]=i,r&&r()):l()},rr=function(n){et.push(n)},vi=function(n,t){for(var i=0;i<et.length;i++)et[i](n,t)},ur=function(){var n=location.href,t=null;n.indexOf("#")>=0&&(t=n.substring(n.indexOf("#")+1));it(t);o.launchAppWithQuery=""},fr=function(n){u.post(r.getData("applicationUrl")+"cmsapi/ApplicationUsage/Log","="+n)},it=function(n){SetLiveSiteURL&&SetLiveSiteURL();var t=wt(n);yi(t.appId)?tt(t):(t.appId=null,typeof Storage!="undefined"&&(t=wt(sessionStorage.cmsLatestApp),sessionStorage.cmsLatestApp=null),t.appId!==null&&yi(t.appId)?(w=!0,v(window,"hash","#"+t.appId),tt(t)):(v(at,"href",o.defaultAppUrl),vi(0,o.defaultAppName)))},wt=function(n){var t,r,i;return n&&n.indexOf("#")!==-1&&(n=n.split("#")[1]),t={},n&&(r=n.split("&"),t.appId=r[0],i=f.rest(r),i&&i.length&&(t.hashParameters={},i.forEach(function(n){var i=n.split("=");t.hashParameters[i[0]]=i[1]}))),t},yi=function(n){return n!=null&&n.length>0&&cr(n)},er=function(n){n.key==27&&y||n.key==113?(ai(),n.wasHandled=!0):n.key==115&&(v(window,"hash","#"),t.publish("DashboardClicked"),n.wasHandled=!0)},or=function(){for(var n=0;n<ot.length;n++)ot[n]()},sr=function(){for(var n=0;n<st.length;n++)st[n]()},pi=function(n){var t=u(this).data("appguid"),r=h===t,i=!1,f=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");return window.history&&window.history.pushState&&window.history.pushState({},"",f+window.location.pathname+window.location.hash),n.which!==2&&(!ri||r?tt({appId:t}):ti.canNavigate()||(i=!0,l())),i?(n.preventDefault(),!1):!0},hr=function(){u("#cms-applist [data-appguid]").each(function(){var n=u(this),r=n.attr("data-appguid"),t="",i=n.contents().filter(function(){return this.nodeType===3});i!==null&&(t=i[0].data);p.push(n);lr(r,t)}).click(pi)},cr=function(n){return bt(n)!==undefined?!0:!1},bt=function(n){return p[n]},lr=function(n,t){p[n]=t},wi=function(n){var t=wt(n.oldURL).hashParameters,i;w=t&&t.ignorehash||w;w||(i=location.hash.substring(1),it(i));w=!1},ar=function(){var t=function(n){n.removeClass("panel");n.children(".panel-collapse").removeClass("collapse").addClass("in").css("height","auto");n.find(".accordion-toggle").attr("data-toggle","")},i=function(n){n.addClass("panel");n.children(".panel-collapse").removeClass("in").addClass("collapse");n.find(".accordion-toggle").attr("data-toggle","collapse")};return function(r,f){var e=new n(r,f,{onStartCb:function(){e.eachParent(t)},onReset:function(){e.eachParent(i)},onParentEmptyCb:function(n){n.hide()},onParentNonemptyCb:function(n){n.show()},onBeforeItemChange:function(n){u(n.children()[0]).tooltip("hide")},onChange:function(){s&&s.reinitialise()},onItemActivated:function(n,t){var i=t.$link.attr("href");return n.ctrlKey?window.top.open(i,"_blank"):window.location.hash!==i?v(window,"href",i):l(),n.preventDefault(),!1},onItemSelected:function(n){var t=n.position().top,i=n.height(),r=c.height();t+i>r+s.getContentPositionY()?s.scrollToY(t+i-r):t<s.getContentPositionY()&&(s.scrollToY(t),s.getContentPositionY()<50&&s.scrollToY(0))}});return e}}(),bi=f.debounce(function(){s&&s.reinitialise()},20),vr=function(n){n.preventDefault();var i=u(this);i.attr("data-pending")||(i.hasClass(ft)?t.publish({name:"cms.applicationdashboard.ApplicationRemoved",onlySubscribed:!0},n.data.guid):(i.attr("data-pending",!0),t.publish({name:"cms.applicationdashboard.ApplicationAdded",onlySubscribed:!0},n.data.guid)))},yr=function(){t.subscribe("cms.applicationdashboard.ApplicationRemoved",function(n){kt(!1,n)});t.subscribe("cms.applicationdashboard.ApplicationAdded",function(n){kt(!0,n)});t.subscribe("cms.applicationdashboard.DashboardItemLoaded",function(n){var t=f.find(p,function(t){return t.attr("data-appguid")===n});t.removeAttr("data-pending")})},kt=function(n,t){var r=f.find(p,function(n){return n.attr("data-appguid")===t}),i;r&&(i=r.find(".dashboard-pin"),n?(r.addClass(ft),i.addClass(gt),i.removeClass(ni)):(r.removeClass(ft),i.addClass(ni),i.removeClass(gt)))},ki=function(n,t){yr();lt=n;lt?(nt.addClass(dt),f.each(p,function(n){var i=n.attr("data-appguid");n.off("click");n.on("click",{guid:i},vr);n.append(u('<i aria-hidden="true" class="icon-pin cms-icon-80 dashboard-pin"><\/i>'));n.tooltip("disable");kt(f(t).contains(i),i)})):(y&&l(),nt.removeClass(dt),f.each(p,function(n){n.off("click");n.on("click",pi);n.children("i.dashboard-pin").remove();n.tooltip("enable")}))},pr,rt;return a=function(n){var a=this,i,r,e;u.extend(o,n);fi=u(window);vt=u(document.body);yt=u(o.appListWrapperElemSelector);b=u(o.appListPanelSelector);k=u(o.appListOverLayerSelector);ei=u(o.appListToggleSelector);oi=u(o.appListToggleCloseSelector);di=u(o.appListHeaderSelector);nt=u(o.appListContentSelector);si=u(o.appListLiveSiteButtonSelector);c=u(o.appListScrollableElemSelector);d=u(o.appListScrollShadowElemSelector);g=u(o.appListScrollShadowElemSelector).addClass("bottom");hr();k.click(function(){l()});ei.click(function(){pt()});oi.click(function(){l()});si.click(function(){l()});o.indentLiveSite||(ii=0);i=document.documentMode;"onhashchange"in window&&(i===undefined||i>7)&&(ri=!0,navigator.userAgent.match(/msie|trident/i)?(r=window.location.hash,e=window.location.href,setInterval(function(){var n=window.location.hash,t=window.location.href;r!==n&&(wi.call(window,{type:"hashchange",newURL:t,oldURL:e}),r=n,e=t)},100)):window.onhashchange=wi);u("[name='"+o.targetFrame+"']").load(function(){window.Loader&&window.Loader.hide();ht=!1;y&&ct&&l();ct=!0});b.on("click",function(){window.top.HideScreenLockWarningAndSync&&(window.CancelScreenLockCountdown(),window.top.HideScreenLockWarningAndSync(o.screenLockInterval))});ur();yt.on({"shown.bs.collapse":bi,"hidden.bs.collapse":bi});fi.resize(f.debounce(function(){y&&s&&s.reinitialise()},250));this.$searchInput=b.find(o.appListSearchInputSelector);this.filter=ar(yt,this.$searchInput);this.onShow(function(){a.$searchInput.focus();s&&s.reinitialise()});this.onHide(function(){a.filter.resetFilter()});t.subscribe("DashboardClicked",function(n){h!==ut?(v(window,"hash",""),n.preventDefault()):v(at,"href",o.defaultAppUrl);h=ut;ki(!1)});t.subscribe("cms.applicationdashboard.DashboardEditableModeChanged",ki);t.subscribe("ShowApplicationList",pt);t.subscribe("HideApplicationList",l);t.subscribe("ToggleApplicationList",ai);t.subscribe("KeyPressed",er);t.subscribe("Tabs_Back_0",ir);t.subscribe("SingleObjectNavigationAppBreadcrumbClick",function(n){var t="";n.tabName&&(t="&tabname="+n.tabName);it(n.appId+t)});t.subscribe("NavigationToApplication",fr)},a.prototype.onShow=function(n){ot.push(n)},a.prototype.onHide=function(n){st.push(n)},a.prototype.getCurrentAppId=function(){return h},a.prototype.getApplicationName=bt,a.prototype.onLaunchApplication=rr,a.prototype.openApplication=it,rt=function(n){n&&(pr=new a(n))},rt.prototype.openApplication=function(n,t,i,r){var u=window.top,f=u.location.search;n===undefined&&(n=u.location.protocol+"//"+u.location.hostname+(u.location.port?":"+u.location.port:""));t===undefined&&(t=u.location.pathname);v(u,"href",hi(n,t,i,r));f===i&&u.location.reload(!0)},rt.prototype.openApplicationInNewWindow=function(n,t,i,r,f){u.browser.msie&&u.browser.version==="9.0"&&r?this.openApplication(n,t,i,r):window.top.open(hi(n,t,i,r),f)},rt})