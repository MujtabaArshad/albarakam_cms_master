function generateGuid(){var n=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return n()+n()+"-"+n()+"-"+n()+"-"+n()+"-"+n()+n()+n()}function getAbsolute(n,t){if(n.substr&&n.substr(n.length-1)==="%"){var i=n.substr(0,n.length-1);n=t*i/100}return n}function getAbsoluteSize(n,t){return n=getAbsolute(n,$window.width()),t=getAbsolute(t,$window.height()),{width:n,height:t}}function storeModal(n){for(var i=0,r=!1,t=0;t<window.allModals.length;t++)window.allModals[t]||(window.allModals[t]=n,i=t,r=!0);return r||(i=window.allModals.length,window.allModals[window.allModals.length]=n),i}function getPercentSize(n,t){var i,r;return n.substr&&n.substr(n.length-1)==="%"?i=n:(i=n/($window.width()/100),i>95&&(i=95),i+="%"),t.substr&&t.substr(t.length-1)==="%"?r=t:(r=t/($window.height()/100),r>95&&(r=95),r+="%"),{width:i,height:r}}function containsWindow(n,t,i){var r,u;if(i==undefined&&(i=!0),n==t)return!0;if(n.frames&&n.frames.length>0)for(r=0;r<n.frames.length;r++)if(u=n.frames[r],i){if(containsWindow(u,t))return!0}else if(n==t)return!0;return!1}function isFullScreen(){var n=$visiblePopup.parent();return n.data("fullScreen")}function toggleFullScreen(){var f={width:"95%",height:"95%"},r={},i,n=$visiblePopup.parent(),t,u;isFullScreen()?(u=n.data("originalSize"),t=getAbsoluteSize(u.width,u.height),i=n.data("originalOffset"),n.find(".ui-resizable-handle").show()):(t=getAbsoluteSize(f.width,f.height),i={top:($window.height()-t.height)/2,left:($window.width()-t.width)/2},n.find(".ui-resizable-handle").hide());n.data("actualOffset",i);n.data("actualSize",t);r.left=i.left+$document.scrollLeft();r.top=i.top+$document.scrollTop();$visiblePopup.width(t.width).height(t.height);n.width(t.width).height(t.height);n.css("left",r.left).css("top",r.top);n.data("fullScreen",!n.data("fullScreen"))}function getExistingModal(n,t){for(var r,u,f,i=0;i<window.allModals.length;i++)if(r=window.allModals[i],r!=null&&(u=r.get(0),f=u.contentWindow,u.name==n&&f.wopener==t))return{frame:r,index:i};return null}function addBackgroundClickHandler(n){$cmsj(".ui-widget-overlay:last").on("click",function(){$cmsj(this).unbind("click");closeDialog(n)})}function removeBackgroundClickHandler(){$cmsj(".ui-widget-overlay:last").unbind("click")}function normalizeDimension(n){return n.toString().indexOf("px")!=-1?parseInt(n,10):n}function advancedModal(n,t,i,r,u,f,e,o,s){var a,y,h,p,l,v;if(window.allModals==undefined&&(window.allModals=[]),getExistingModal(t,s)==null){i==null&&(i="95%");r==null&&(r="95%");i=normalizeDimension(i);r=normalizeDimension(r);a=getPercentSize(i,r);i=a.width;r=a.height;typeof u=="string"&&(y=u.split(","),u={},y.forEach(function(n){var i=n.trim().split("="),t=i[1].toLowerCase().trim();u[i[0].trim()]=t==="yes"||t==="true"||t==="1"}));h=$cmsj(document.createElement("iframe"));storeModal(h);p=$cmsj("#modalWrap");p.append(h);l=getAbsoluteSize(i,r);h.attr("width",l.width);h.attr("height",l.height);h.attr("class","UIPopupDialog");h.attr("frameBorder",0);h.attr("id",generateGuid());h.attr("name",t);h.attr("src","about:blank");$visiblePopup=h;o||(h.get(0).stopAutoTitle=!0);storeWopener(h,s);$cmsj.widget("ui.dialog",$cmsj.ui.dialog,{_allowInteraction:function(n){return window.CMS.AdvancedPopupHandler.getInteractionAllowance(n)||this._super(n)}});var k=h.dialog({resizable:u.resizable,modal:u.modal||e,closeOnEscape:!1,width:l.width,height:l.height,zIndex:1e3,create:function(){h.attr("src",n)},open:function(n){function u(n){return n<1}function f(n){return $cmsj("frame",n).length!==0}function e(){window.Loader&&window.Loader.show()}function o(n){var t=!1;return f(n.contentDocument)?$cmsj("frame",n.contentDocument).each(function(n,i){$cmsj(".close-button",i.contentDocument).length>0&&(t=!0)}):t=$cmsj(".close-button",n.contentDocument).length>0,t}function i(){window.Loader&&window.Loader.hide();r=!0;o(t)&&removeBackgroundClickHandler()}var t=n.target,r=!1;$cmsj(t).ready(function(){window.CMS&&window.CMS.AdvancedPopupHandler&&window.CMS.AdvancedPopupHandler.stopPropagation(t.contentWindow);r||e()});$cmsj(t).load(function(){if(window.CMS&&window.CMS.AdvancedPopupHandler&&window.CMS.AdvancedPopupHandler.stopPropagation(t.contentWindow),f(t.contentDocument)&&$cmsj.browser.webkit){var n=0;$cmsj("frame",t.contentDocument).each(function(t,r){r.contentDocument.pageLoaded||(n++,r.onload=function(){n--;u(n)&&i()})});u(n)&&i()}else i()})}}).css({width:l.width+"px",height:l.height+"px",padding:0}),c=$visiblePopup.parent(),w=c.offset(),b={left:w.left-$document.scrollLeft(),top:w.top-$document.scrollTop()};c.data("originalOffset",b);c.data("actualOffset",b);v={width:c.width(),height:c.height()};c.data("originalSize",v);c.data("actualSize",v);c.addClass("cms-bootstrap");$cmsj(".ui-widget-overlay").addClass("cms-ui-widget-overlay");addBackgroundClickHandler(k.get(0).contentWindow);u.openInFullscreen&&!isFullScreen()&&toggleFullScreen()}}function isTitleWindow(n,t){if(n==t)return!0;if(n.frames&&n.frames.length>0){var i=n.frames[0];return containsWindow(i,t,!1)?!0:isTitleWindow(i,t)}return!1}function closeDialog(n){for(var i,r,u,t=0;t<window.allModals.length;t++)if(i=window.allModals[t],r=i.get(0).contentWindow,containsWindow(r,n)){window.CMS&&window.CMS.AdvancedPopupHandler&&window.CMS.AdvancedPopupHandler.allowPropagation(r);$cmsj.browser.opera||i.attr("src","about:blank");removeWopener(n);i.remove();window.allModals.splice(t,1);$cmsj(":visible:first").focus();break}for(t;t>=0;t--)if(u=window.allModals[t],u!=null){$visiblePopup=u;break}else $visiblePopup=null}function initWopeners(){window.allWopeners==undefined&&(window.allWopeners=[])}function storeWopener(n,t){initWopeners();window.allWopeners[n.get(0).id]=t}function removeWopener(n){initWopeners();var t=getWopenerKey(n);t&&(allWopeners[t]=null)}function getWopenerKey(n){var t,i,r;if(initWopeners(),window.allModals)for(t=0;t<window.allModals.length;t++)if(i=window.allModals[t],i!=null&&(r=i.get(0).contentWindow,containsWindow(r,n)))return i.get(0).id;return null}function getWopener(n){initWopeners();var t=getWopenerKey(n);return t?allWopeners[t]:null}function getTop(n){var t,r,i;if(window.allModals&&n!=top)for(t=0;t<window.allModals.length;t++)if(r=window.allModals[t],i=r.get(0),containsWindow(i.contentWindow,n))return i.contentWindow;return window.top}window.AdvancedModalDialogs=!0;var $document=$cmsj(document),$window=$cmsj(window),$visiblePopup=null;cmsdefine(["CMS/EventHub"],function(n){var t,i=function(n){n.notContinue=!0},r=function(n){n.notContinue=!0},u=function(n){return n.location.href!="about:blank"},f=function(t){u(t)&&!t.propagationStopped&&(t.propagationStopped=!0,n.subscribe({name:"KeyPressed",window:t},i),n.subscribe({name:"GlobalClick",window:t},r))},e=function(t){u(t)&&t.propagationStopped&&(t.propagationStopped=!1,n.unsubscribe({name:"KeyPressed",window:t},i),n.unsubscribe({name:"GlobalClick",window:t},r))},o=function(n,i){t=t||{};t[n]=i},s=function(n){t&&t.hasOwnProperty(n)&&delete t[n]},h=function(n){var i=!1;if(t)for(name in t)t.hasOwnProperty(name)&&(i|=t[name](n));return i};return function(){this.stopPropagation=f;this.allowPropagation=e;this.addInteractionHandler=o;this.removeInteractionHandler=s;this.getInteractionAllowance=h;window.CMS=window.CMS||{};window.CMS.AdvancedPopupHandler=this}})